const hexTable=(new TextEncoder).encode("0123456789abcdef");function errInvalidByte(e){return new TypeError(`Invalid byte '${String.fromCharCode(e)}'`)}function errLength(){return new RangeError("Odd length hex string")}function fromHexChar(e){if(48<=e&&e<=57)return e-48;if(97<=e&&e<=102)return e-97+10;if(65<=e&&e<=70)return e-65+10;throw errInvalidByte(e)}function encode(e){const t=new Uint8Array(2*e.length);for(let n=0;n<t.length;n++){const r=e[n];t[2*n]=hexTable[r>>4],t[2*n+1]=hexTable[15&r]}return t}function decode(e){const t=new Uint8Array(e.length/2);for(let n=0;n<t.length;n++){const r=fromHexChar(e[2*n]),i=fromHexChar(e[2*n+1]);t[n]=r<<4|i}if(e.length%2==1)throw fromHexChar(e[2*t.length]),errLength();return t}const base64abc=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function encode1(e){const t="string"==typeof e?(new TextEncoder).encode(e):e instanceof Uint8Array?e:new Uint8Array(e);let n,r="";const i=t.length;for(n=2;n<i;n+=3)r+=base64abc[t[n-2]>>2],r+=base64abc[(3&t[n-2])<<4|t[n-1]>>4],r+=base64abc[(15&t[n-1])<<2|t[n]>>6],r+=base64abc[63&t[n]];return n===i+1&&(r+=base64abc[t[n-2]>>2],r+=base64abc[(3&t[n-2])<<4],r+="=="),n===i&&(r+=base64abc[t[n-2]>>2],r+=base64abc[(3&t[n-2])<<4|t[n-1]>>4],r+=base64abc[(15&t[n-1])<<2],r+="="),r}function decode1(e){const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r}const noop=()=>{};class AsyncIterableClone{currentPromise;resolveCurrent=noop;consumed;consume=noop;constructor(){this.currentPromise=new Promise((e=>{this.resolveCurrent=e})),this.consumed=new Promise((e=>{this.consume=e}))}reset(){this.currentPromise=new Promise((e=>{this.resolveCurrent=e})),this.consumed=new Promise((e=>{this.consume=e}))}async next(){const e=await this.currentPromise;return this.consume(),this.reset(),e}async push(e){this.resolveCurrent(e),await this.consumed}[Symbol.asyncIterator](){return this}}class DeadlineError extends Error{constructor(){super("Deadline"),this.name="DeadlineError"}}const ANSI_PATTERN=new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|"),"g");var DiffType;!function(e){e.removed="removed",e.common="common",e.added="added"}(DiffType||(DiffType={}));class AssertionError extends Error{constructor(e){super(e),this.name="AssertionError"}}class DenoStdInternalError extends Error{constructor(e){super(e),this.name="DenoStdInternalError"}}function assert(e,t=""){if(!e)throw new DenoStdInternalError(t)}function copy(e,t,n=0){n=Math.max(0,Math.min(n,t.byteLength));const r=t.byteLength-n;return e.byteLength>r&&(e=e.subarray(0,r)),t.set(e,n),e.byteLength}const MIN_READ=32768,MAX_SIZE=2**32-2;class Buffer{#buf;#off=0;constructor(e){this.#buf=void 0===e?new Uint8Array(0):new Uint8Array(e)}bytes(e={copy:!0}){return!1===e.copy?this.#buf.subarray(this.#off):this.#buf.slice(this.#off)}empty(){return this.#buf.byteLength<=this.#off}get length(){return this.#buf.byteLength-this.#off}get capacity(){return this.#buf.buffer.byteLength}truncate(e){if(0!==e){if(e<0||e>this.length)throw Error("bytes.Buffer: truncation out of range");this.#reslice(this.#off+e)}else this.reset()}reset(){this.#reslice(0),this.#off=0}#tryGrowByReslice(e){const t=this.#buf.byteLength;return e<=this.capacity-t?(this.#reslice(t+e),t):-1}#reslice(e){assert(e<=this.#buf.buffer.byteLength),this.#buf=new Uint8Array(this.#buf.buffer,0,e)}readSync(e){if(this.empty())return this.reset(),0===e.byteLength?0:null;const t=copy(this.#buf.subarray(this.#off),e);return this.#off+=t,t}read(e){const t=this.readSync(e);return Promise.resolve(t)}writeSync(e){const t=this.#grow(e.byteLength);return copy(e,this.#buf,t)}write(e){const t=this.writeSync(e);return Promise.resolve(t)}#grow(e){const t=this.length;0===t&&0!==this.#off&&this.reset();const n=this.#tryGrowByReslice(e);if(n>=0)return n;const r=this.capacity;if(e<=Math.floor(r/2)-t)copy(this.#buf.subarray(this.#off),this.#buf);else{if(r+e>MAX_SIZE)throw new Error("The buffer cannot be grown beyond the maximum size.");{const t=new Uint8Array(Math.min(2*r+e,MAX_SIZE));copy(this.#buf.subarray(this.#off),t),this.#buf=t}}return this.#off=0,this.#reslice(Math.min(t+e,MAX_SIZE)),t}grow(e){if(e<0)throw Error("Buffer.grow: negative count");const t=this.#grow(e);this.#reslice(t)}async readFrom(e){let t=0;const n=new Uint8Array(32768);for(;;){const r=this.capacity-this.length<32768,i=r?n:new Uint8Array(this.#buf.buffer,this.length),s=await e.read(i);if(null===s)return t;r?this.writeSync(i.subarray(0,s)):this.#reslice(this.length+s),t+=s}}readFromSync(e){let t=0;const n=new Uint8Array(32768);for(;;){const r=this.capacity-this.length<32768,i=r?n:new Uint8Array(this.#buf.buffer,this.length),s=e.readSync(i);if(null===s)return t;r?this.writeSync(i.subarray(0,s)):this.#reslice(this.length+s),t+=s}}}function notImplemented(e){throw new Error(e?`Not implemented: ${e}`:"Not implemented")}function normalizeEncoding(e){return null==e||"utf8"===e||"utf-8"===e?"utf8":slowCases(e)}function slowCases(e){switch(e.length){case 4:if("UTF8"===e)return"utf8";if("ucs2"===e||"UCS2"===e)return"utf16le";if("utf8"===(e=`${e}`.toLowerCase()))return"utf8";if("ucs2"===e)return"utf16le";break;case 3:if("hex"===e||"HEX"===e||"hex"===`${e}`.toLowerCase())return"hex";break;case 5:if("ascii"===e)return"ascii";if("ucs-2"===e)return"utf16le";if("UTF-8"===e)return"utf8";if("ASCII"===e)return"ascii";if("UCS-2"===e)return"utf16le";if("utf-8"===(e=`${e}`.toLowerCase()))return"utf8";if("ascii"===e)return"ascii";if("ucs-2"===e)return"utf16le";break;case 6:if("base64"===e)return"base64";if("latin1"===e||"binary"===e)return"latin1";if("BASE64"===e)return"base64";if("LATIN1"===e||"BINARY"===e)return"latin1";if("base64"===(e=`${e}`.toLowerCase()))return"base64";if("latin1"===e||"binary"===e)return"latin1";break;case 7:if("utf16le"===e||"UTF16LE"===e||"utf16le"===`${e}`.toLowerCase())return"utf16le";break;case 8:if("utf-16le"===e||"UTF-16LE"===e||"utf-16le"===`${e}`.toLowerCase())return"utf16le";break;default:if(""===e)return"utf8"}}const notImplementedEncodings=["ascii","binary","latin1","ucs2","utf16le"];function checkEncoding(e="utf8",t=!0){if("string"!=typeof e||t&&""===e){if(!t)return"utf8";throw new TypeError(`Unkown encoding: ${e}`)}const n=normalizeEncoding(e);if(void 0===n)throw new TypeError(`Unkown encoding: ${e}`);return notImplementedEncodings.includes(e)&&notImplemented(`"${e}" encoding`),n}const encodingOps={utf8:{byteLength:e=>(new TextEncoder).encode(e).byteLength},ucs2:{byteLength:e=>2*e.length},utf16le:{byteLength:e=>2*e.length},latin1:{byteLength:e=>e.length},ascii:{byteLength:e=>e.length},base64:{byteLength:e=>base64ByteLength(e,e.length)},hex:{byteLength:e=>e.length>>>1}};function base64ByteLength(e,t){return 61===e.charCodeAt(t-1)&&t--,t>1&&61===e.charCodeAt(t-1)&&t--,3*t>>>2}class Buffer1 extends Uint8Array{static alloc(e,t,n="utf8"){if("number"!=typeof e)throw new TypeError('The "size" argument must be of type number. Received type '+typeof e);const r=new Buffer1(e);if(0===e)return r;let i;if("string"==typeof t){const e=checkEncoding(n);"string"==typeof t&&1===t.length&&"utf8"===e?r.fill(t.charCodeAt(0)):i=Buffer1.from(t,e)}else if("number"==typeof t)r.fill(t);else if(t instanceof Uint8Array){if(0===t.length)throw new TypeError(`The argument "value" is invalid. Received ${t.constructor.name} []`);i=t}if(i){i.length>r.length&&(i=i.subarray(0,r.length));let t=0;for(;t<e&&(r.set(i,t),t+=i.length,!(t+i.length>=e)););t!==e&&r.set(i.subarray(0,e-t),t)}return r}static allocUnsafe(e){return new Buffer1(e)}static byteLength(e,t="utf8"){return"string"!=typeof e?e.byteLength:(t=normalizeEncoding(t)||"utf8",encodingOps[t].byteLength(e))}static concat(e,t){if(null==t){t=0;for(const n of e)t+=n.length}const n=Buffer1.allocUnsafe(t);let r=0;for(const t of e){let e;e=t instanceof Buffer1?t:Buffer1.from(t),e.copy(n,r),r+=e.length}return n}static from(e,t,n){const r="string"==typeof t?void 0:t;let i="string"==typeof t?t:void 0;return"string"==typeof e?(i=checkEncoding(i,!1),new Buffer1("hex"===i?decode((new TextEncoder).encode(e)).buffer:"base64"===i?decode1(e).buffer:(new TextEncoder).encode(e).buffer)):new Buffer1(e,r,n)}static isBuffer(e){return e instanceof Buffer1}static isEncoding(e){return"string"==typeof e&&0!==e.length&&void 0!==normalizeEncoding(e)}copy(e,t=0,n=0,r=this.length){const i=this.subarray(n,r).subarray(0,Math.max(0,e.length-t));return 0===i.length?0:(e.set(i,t),i.length)}equals(e){if(!(e instanceof Uint8Array))throw new TypeError('The "otherBuffer" argument must be an instance of Buffer or Uint8Array. Received type '+typeof e);if(this===e)return!0;if(this.byteLength!==e.byteLength)return!1;for(let t=0;t<this.length;t++)if(this[t]!==e[t])return!1;return!0}readBigInt64BE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getBigInt64(e)}readBigInt64LE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getBigInt64(e,!0)}readBigUInt64BE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getBigUint64(e)}readBigUInt64LE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getBigUint64(e,!0)}readDoubleBE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getFloat64(e)}readDoubleLE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getFloat64(e,!0)}readFloatBE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getFloat32(e)}readFloatLE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getFloat32(e,!0)}readInt8(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getInt8(e)}readInt16BE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getInt16(e)}readInt16LE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getInt16(e,!0)}readInt32BE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getInt32(e)}readInt32LE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getInt32(e,!0)}readUInt8(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getUint8(e)}readUInt16BE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getUint16(e)}readUInt16LE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getUint16(e,!0)}readUInt32BE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getUint32(e)}readUInt32LE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getUint32(e,!0)}slice(e=0,t=this.length){return this.subarray(e,t)}toJSON(){return{type:"Buffer",data:Array.from(this)}}toString(e="utf8",t=0,n=this.length){e=checkEncoding(e);const r=this.subarray(t,n);return"hex"===e?(new TextDecoder).decode(encode(r)):"base64"===e?encode1(r.buffer):new TextDecoder(e).decode(r)}write(e,t=0,n=this.length){return(new TextEncoder).encodeInto(e,this.subarray(t,t+n)).written}writeBigInt64BE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setBigInt64(t,e),t+4}writeBigInt64LE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setBigInt64(t,e,!0),t+4}writeBigUInt64BE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setBigUint64(t,e),t+4}writeBigUInt64LE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setBigUint64(t,e,!0),t+4}writeDoubleBE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setFloat64(t,e),t+8}writeDoubleLE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setFloat64(t,e,!0),t+8}writeFloatBE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setFloat32(t,e),t+4}writeFloatLE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setFloat32(t,e,!0),t+4}writeInt8(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setInt8(t,e),t+1}writeInt16BE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setInt16(t,e),t+2}writeInt16LE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setInt16(t,e,!0),t+2}writeInt32BE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint32(t,e),t+4}writeInt32LE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setInt32(t,e,!0),t+4}writeUInt8(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint8(t,e),t+1}writeUInt16BE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint16(t,e),t+2}writeUInt16LE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint16(t,e,!0),t+2}writeUInt32BE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint32(t,e),t+4}writeUInt32LE(e,t=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint32(t,e,!0),t+4}}const UID=generateUID(),PLACE_HOLDER_REGEXP=new RegExp('(\\\\)?"@__(F|R|D|M|S|A|U|I|B)-'+UID+'-(\\d+)__@"',"g"),IS_NATIVE_CODE_REGEXP=/\{\s*\[native code\]\s*\}/g,IS_PURE_FUNCTION=/function.*?\(/,IS_ARROW_FUNCTION=/.*?=>.*?/,UNSAFE_CHARS_REGEXP=/[<>\/\u2028\u2029]/g,RESERVED_SYMBOLS=["*","async"],ESCAPED_CHARS={"<":"\\u003C",">":"\\u003E","/":"\\u002F","\u2028":"\\u2028","\u2029":"\\u2029"};function escapeUnsafeChars(e){return ESCAPED_CHARS[e]}function generateUID(){const e=randomBytes(16);let t="";for(let n=0;n<16;++n)t+=e[n].toString(16);return t}function deleteFunctions(e){const t=[];for(const n in e)"function"==typeof e[n]&&t.push(n);for(let n=0;n<t.length;n++)delete e[t[n]]}function serialize1(e,t){t||(t={}),"number"!=typeof t&&"string"!=typeof t||(t={space:t});const n=[],r=[],i=[],s=[],f=[],o=[],a=[],h=[],u=[];if(t.ignoreFunction&&"function"==typeof e&&(e=void 0),void 0===e)return String(e);let c;return c=t.isJSON&&!t.space?JSON.stringify(e):JSON.stringify(e,t.isJSON?null:function(e,c){if(t.ignoreFunction&&deleteFunctions(c),!c&&void 0!==c)return c;const b=this[e],g=typeof b;if("object"===g){if(b instanceof RegExp)return"@__R-"+UID+"-"+(r.push(b)-1)+"__@";if(b instanceof Date)return"@__D-"+UID+"-"+(i.push(b)-1)+"__@";if(b instanceof Map)return"@__M-"+UID+"-"+(s.push(b)-1)+"__@";if(b instanceof Set)return"@__S-"+UID+"-"+(f.push(b)-1)+"__@";if(b instanceof Array&&b.filter((function(){return!0})).length!==b.length)return"@__A-"+UID+"-"+(o.push(b)-1)+"__@"}return"function"===g?"@__F-"+UID+"-"+(n.push(b)-1)+"__@":"undefined"===g?"@__U-"+UID+"-"+(a.push(b)-1)+"__@":"number"!==g||isNaN(b)||isFinite(b)?"bigint"===g?"@__B-"+UID+"-"+(u.push(b)-1)+"__@":c:"@__I-"+UID+"-"+(h.push(b)-1)+"__@"},t.space),"string"!=typeof c?String(c):(!0!==t.unsafe&&(c=c.replace(UNSAFE_CHARS_REGEXP,escapeUnsafeChars)),0===n.length&&0===r.length&&0===i.length&&0===s.length&&0===f.length&&0===o.length&&0===a.length&&0===h.length&&0===u.length?c:c.replace(PLACE_HOLDER_REGEXP,((e,a,c,b)=>{if(a)return e;if("D"===c)return'new Date("'+i[b].toISOString()+'")';if("R"===c)return"new RegExp("+serialize1(r[b].source)+', "'+r[b].flags+'")';if("M"===c)return"new Map("+serialize1(Array.from(s[b].entries()),t)+")";if("S"===c)return"new Set("+serialize1(Array.from(f[b].values()),t)+")";if("A"===c)return"Array.prototype.slice.call("+serialize1(Object.assign({length:o[b].length},o[b]),t)+")";if("U"===c)return"undefined";if("I"===c)return h[b];if("B"===c)return'BigInt("'+u[b]+'")';return function(e){const t=e.toString();if(IS_NATIVE_CODE_REGEXP.test(t))throw new TypeError("Serializing native function: "+e.name);if(IS_PURE_FUNCTION.test(t))return t;if(IS_ARROW_FUNCTION.test(t))return t;const n=t.indexOf("("),r=t.substr(0,n).trim().split(" ").filter((e=>e.length>0));return r.filter((e=>-1===RESERVED_SYMBOLS.indexOf(e))).length>0?(r.indexOf("async")>-1?"async ":"")+"function"+(r.join("").indexOf("*")>-1?"*":"")+t.substr(n):t}(n[b])})))}const deserialize1=e=>new Function("data",`return (${e})`)(e);export{serialize1 as serialize,deserialize1 as deserialize};